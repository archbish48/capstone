version: '3.8'

services:
  # Spring Boot 애플리케이션 서비스
  app:
    image: your-app-name:1.0 # 실제 이미지 이름 및 태그로 대체하세요.
    container_name: unihelper-app
    ports:
      - "8080:8080" # 호스트의 8080 포트를 컨테이너의 8080 포트와 연결합니다.
    environment:
      # 이 변수들은 .env 파일의 값으로 대체됩니다.
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      - MAIL_USERNAME=${MAIL_USERNAME}
      - MAIL_APP_PASSWORD=${MAIL_APP_PASSWORD}
      - FASTAPI_BASE_URL=http://fastapi:8000 # Docker 내부 DNS를 사용하여 통신합니다.
      - PUBLIC_BASE_URL=${PUBLIC_BASE_URL}
      - FILE_DIR=/app/uploads # 볼륨 마운트 경로와 일치해야 합니다.
    volumes:
      - unihelper-files:/app/uploads # 파일 영속성을 위한 볼륨을 마운트합니다.
    depends_on:
      - db
      - fastapi

  # MySQL 데이터베이스 서비스
  db:
    image: mysql:8.0
    container_name: unihelper-db
    environment:
      # DB 설정
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD} # DB root 계정 비밀번호
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - MYSQL_USER=${DB_USERNAME}
      - MYSQL_PASSWORD=${DB_PASSWORD}
    volumes:
      - unihelper-db-data:/var/lib/mysql # DB 데이터 영구 저장을 위한 볼륨

  # FastAPI 서비스
  fastapi:
    image: your-fastapi-image:1.0 # 실제 FastAPI 이미지 이름 및 태그로 대체하세요.
    container_name: unihelper-fastapi
    ports:
      - "8000:8000"
    volumes:
      - unihelper-files:/app/uploads # 메인 앱과 동일한 파일 볼륨을 공유합니다.

# 데이터 영속성을 위한 볼륨
volumes:
  unihelper-files:
    driver: local
  unihelper-db-data:
    driver: local